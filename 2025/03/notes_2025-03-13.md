[Home](../../main.md) | [Prev: Day 102](notes_2025-03-12.md) | [Next: Day 104](./notes_2025-03-14.md)

## 📝 Day 103, Thursday - `notes_2025-03-13.md`

- US224: request to include protocol and created/completed date for the 600+ exp ids with '?' 
    * example output from SQL
    * use the below sql to output chunks of 50 as comma delimited rows and concatenated by |

```sql
SELECT LISTAGG(
   protocol || ',' || experiment_id || ',' ||
   TO_CHAR(created_date, 'YYYY-MM-DD HH24:MI:SS') || ',' ||
   TO_CHAR(completed_date, 'YYYY-MM-DD HH24:MI:SS'), ' | '
) WITHIN GROUP (ORDER BY experiment_id)
FROM (
   SELECT b.protocol, 
          a.experiment_id, 
          a.created_date, 
          a.completed_date, 
          CEIL(ROWNUM / 50) AS chunk_num
   FROM tm_experiments a
   JOIN tm_protocols b ON a.protocol_id = b.protocol_id
   WHERE experiment_id IN (

138606, 138784, 139184, 139229, 139333, 139366, 139547, 139559, 139673, 139686, 139710, 139716, 139971, 140199, 140442, 141394, 141569, 141588, 141851, 142022, 142248, 142622, 142648, 142649, 142709, 142710, 142726, 142745, 142746, 142763, 142861, 142863, 143109, 143325, 143524, 143526, 143545, 143794, 144419, 144441, 144485, 144488, 144562, 144584, 144586, 144704, 144832, 144957, 145150, 145301, 145431, 145489, 145637, 145718, 145790, 145866, 146013, 146623, 146696, 147096, 147516, 147614, 148010, 148351, 148628, 148968, 149057, 149658, 149828, 149864, 149939, 150324, 150441, 150476, 150560, 152548, 152647, 152823, 152856, 152858, 152863, 153056, 153261, 153430, 153633, 153986, 154642, 155407, 155718, 156157, 156573, 156771, 156831, 157251, 157390, 157845, 157858, 157884, 157885, 157887, 158461, 158504, 158648, 158654, 158660, 158804, 159305, 159568, 159826, 160317, 160324, 160325, 160326, 160826, 160944, 160949, 161059, 161352, 161500, 161635, 162024, 162250, 162374, 163275, 163457, 164157, 164445, 164849, 164975, 164978, 165177, 165404, 165617, 165619, 165621, 166428, 167183, 168421, 168750, 168950, 169020, 169928, 169978, 170055, 170058, 170101, 170145, 170341, 171819, 173148, 173425, 173788, 174005, 174093, 174595, 175917, 176069, 176519, 176683, 176775, 178004, 178168, 178236, 178326, 178509, 179448, 179522, 179528, 179540, 180354, 180525, 180636, 180665, 180666, 180682, 180791, 180892, 180936, 181336, 181414, 182372, 182408, 182409, 182421, 182474, 182582, 183092, 183194, 183453, 183464, 183767, 183850, 183975, 184197, 184218, 184431, 184623, 184657, 184850, 184929, 185023, 185050, 185178, 185442, 185851, 185889, 185976, 185983, 186945, 187173, 187241, 187549, 188768, 189414, 189706, 189811, 190835, 190882, 190883, 191075, 191111, 191121, 191125, 191126, 191364, 191434, 191865, 192075, 192138, 192261, 192373, 192526, 192580, 192929, 193090, 193350, 193428, 193540, 193860, 193886, 194049, 194312, 194501, 194671, 194839, 195369, 195459, 195662, 195863, 196064, 196086, 196087, 196329, 196355, 196395, 196423, 196586, 196717, 196852, 197164, 197285, 197305, 197446, 197791, 197915, 198159, 198490, 198707, 199296, 199342, 199477, 199908, 199923, 200121, 200146, 200278, 200546, 200547, 200639, 201388, 201526, 201767, 202113, 202578, 202638, 202678, 202681, 202774, 203497, 203535, 205469, 205473, 205491, 205931, 206064, 206108, 206117, 206118, 206121, 206192, 206441, 206594, 206671, 206798, 206834, 206881, 206890, 207072, 207073, 207075, 207085, 207168, 207174, 207175, 207312, 207321, 207393, 207414, 207509, 207532, 207577, 207610, 207754, 207912, 207920, 208248, 208277, 208459, 208467, 208553, 208674, 208745, 209046, 209098, 209101, 209159, 209188, 209224, 209252, 209272, 209356, 209495, 209566, 209567, 209584, 209605, 209609, 209650, 209670, 209674, 209701, 209910, 209924, 210012, 210275, 210473, 210587, 210847, 211189, 211323, 212460, 213067, 213635, 213638, 214150, 214151, 214512, 214829, 214963, 215385, 215912, 215978, 216848, 217168, 217247, 217359, 218368, 218952, 219167, 219344, 220381, 220449, 220712, 221389, 221409, 222169, 222171, 222311, 222568, 222577, 222641, 223370, 223469, 223941, 224488, 225006, 225047, 225153, 225250, 225428, 225432, 225434, 225700, 225909, 226053, 226247, 226306, 226343, 226407, 226664, 226713, 227022, 227266, 227915, 228197, 228299, 228849, 228941, 229012, 229273, 229274, 229371, 229499, 229828, 230117, 230790, 230797, 230801, 230840, 231094, 231377, 231387, 231391, 231468, 231614, 231827, 231858, 232096, 232209, 232210, 232399, 232587, 232613, 232664, 232996, 233004, 233076, 233101, 233253, 233542, 233543, 233555, 233706, 234064, 234146, 234273, 234279, 234290, 234295, 234615, 234862, 235011, 235176, 235222, 235516, 235612, 235619, 235916, 236148, 236443, 236444, 236445, 236533, 237070, 237135, 237324, 237418, 237943, 238664, 238692, 238710, 238969, 239156, 239180, 239250, 239297, 239328, 239334, 239380, 239469, 239661, 239752, 239769, 240216, 240372, 240666, 240787, 240885, 240888, 241073, 241293, 241304, 241316, 241470, 241520, 242037, 242195, 242203, 242376, 242566, 242757, 243064, 244062, 244353, 244442, 244803, 245036, 245109, 245281, 245406, 245421, 245689, 245923, 245935, 246226, 246235, 246236, 246240, 246321, 246452, 246609, 246896, 247328, 247426, 247462, 247466, 247552, 247596, 247766, 247883, 247920, 247948, 248077, 248188, 248570, 248615, 248663, 248728, 249031, 249562, 249646, 249648, 249667, 249682, 249683, 249983, 250074, 250111, 250427, 250757, 251509, 251519, 251603, 251915, 251916, 251917, 251918, 251919, 251920, 252200, 252260, 252426, 252435, 252681, 252772, 252950, 253050, 253068, 253070, 253083, 253253, 253267, 253374, 253421, 253567, 253945, 254023, 254040, 254282, 254355, 254643, 254692, 254849, 255133, 255230, 255428, 255995, 256068, 256108, 256109, 256116, 256200, 256275, 256350, 256380, 256451, 256511, 256522, 256663, 256665, 256685, 256872, 256875, 256948, 257084, 257159, 257177, 257344, 257443, 257540, 257564, 257903, 257974, 258356, 258523, 258664, 258794, 259087, 259383, 259417, 259421, 259422, 259463, 259668, 260163, 260172, 260178, 260245, 260288, 260345, 260500, 260516, 260570, 260667, 261177, 261289, 261317, 261401, 261613, 261819, 261887, 261968, 261991, 262058, 262117, 262732, 262912, 263216, 263319, 263405, 263621, 263836, 264030, 264979, 265046, 265048, 265050, 265162, 265296, 265488, 265489, 265743, 265784, 265928, 266135, 266388, 266494, 266559, 266666, 267059, 267076, 267088, 267101, 267198, 267203, 267217, 267342, 267383, 267397
)
) 
GROUP BY chunk_num
```

- sample output of 3rd row:
    * use neovim macro to convert to csv file
    * read into pandas in jupyter labs
```
CRO_Affinity_CR,158461,2019-07-22 08:47:50, | CRO_Medic_ChemELN,158504,2019-07-23 02:50:28,2019-08-01 04:59:07 | CRO_Medic_ChemELN,158648,2019-07-26 05:59:21,2019-08-01 04:54:42 | ChemELN,158654,2019-07-26 10:14:15,2019-09-17 17:16:40 | CRO_Affinity_CR,158660,2019-07-26 12:01:34, | CRO_Medic_ChemELN,158804,2019-07-31 04:53:39,2019-08-01 06:07:55 | ChemELN,159305,2019-08-13 11:11:11,2019-09-05 12:30:18 | ChemELN,159568,2019-08-20 16:40:07, | CRO_Medic_ChemELN,159826,2019-08-28 05:46:10,2019-08-29 02:39:12 | ChemELN,160317,2019-09-11 10:41:20,2019-09-17 17:14:07 | ChemELN,160324,2019-09-11 11:36:50,2019-09-16 17:46:46 | ChemELN,160325,2019-09-11 11:36:56,2019-09-16 17:54:25 | ChemELN,160326,2019-09-11 11:37:02,2019-09-17 12:02:56 | CRO_Medic_ChemELN,160826,2019-09-25 04:18:13,2019-09-27 01:20:44 | ChemELN,160944,2019-09-27 15:06:53,2019-10-08 17:16:25 | ChemELN,160949,2019-09-27 16:15:43,2019-10-22 13:32:39 | ChemELN,161059,2019-10-02 16:30:23, | ChemELN,161352,2019-10-11 11:15:39,2019-10-22 14:12:46 | CRO_Affinity_CR,161500,2019-10-15 16:48:44, | ChemELN,161635,2019-10-18 12:22:02, | CRO_Affinity_CR,162024,2019-10-28 15:34:54, | CRO_Affinity_CR,162250,2019-11-03 09:54:01, | ChemELN,162374,2019-11-05 17:47:59,2019-12-03 15:24:08 | CRO_Affinity_CR,163275,2019-11-29 08:18:26, | ChemELN,163457,2019-12-04 10:56:23,2019-12-18 11:13:05 | CRO_Affinity_CR,164157,2019-12-24 15:05:13, | CRO_Affinity_CR,164445,2020-01-07 09:12:50, | CRO_Affinity_CR,164849,2020-01-20 11:45:29, | ChemELN,164975,2020-01-27 07:30:30,2020-01-29 15:19:25 | ChemELN,164978,2020-01-27 09:43:30,2020-05-05 12:24:58 | ChemELN,165177,2020-02-04 11:30:57,2020-02-10 15:40:53 | ChemELN,165404,2020-02-13 18:32:24,2024-02-27 11:38:19 | CRO_Viva_ChemELN,165617,2020-02-19 00:28:40,2021-08-12 04:48:21 | CRO_Viva_ChemELN,165619,2020-02-19 00:31:09,2021-08-12 04:47:22 | CRO_Viva_ChemELN,165621,2020-02-19 01:07:52,2021-08-12 04:45:51 | ChemELN,166428,2020-03-11 15:33:46, | CRO_Viva_ChemELN,167183,2020-04-07 01:07:29,2020-06-08 00:22:08 | CRO_Medic_ChemELN,168421,2020-05-19 04:53:22,2020-05-26 01:25:33 | ChemELN,168750,2020-05-28 10:47:07,2020-06-01 12:26:47 | CRO_Medic_ChemELN,168950,2020-06-04 03:50:52,2020-06-08 04:41:34 | CRO_Affinity_CR,169020,2020-06-05 15:26:09,2020-07-05 11:02:18 | ChemELN,169928,2020-07-01 16:13:02,2020-07-21 14:55:24 | CRO_Viva_ChemELN,169978,2020-07-03 01:04:06,2020-07-08 00:58:28 | ChemELN,170055,2020-07-06 16:23:48, | ChemELN,170058,2020-07-06 20:57:01, | ChemELN,170101,2020-07-08 02:02:48, | ChemELN,170145,2020-07-09 07:50:43,2020-07-10 14:00:13 | ChemELN,170341,2020-07-14 18:08:02, | ChemELN,171819,2020-08-31 11:08:00,2020-09-08 15:49:59 | CRO_Viva_ChemELN,173148,2020-10-16 02:52:53,2021-02-04 23:59:46
```

- following are perfect examples of using generic to capture all cases, with the regex it didn't capture these cases
    * index 93, exp id = 156831
    * index 138, exp id = 168421
    * index 141, exp id = 169020
    * index 146, exp id = 170101
    * index 152, exp id = 173788
    * index 158, exp id = 176519

##### US208
```sql
SELECT
    t4.experiment_id AS experiment_id,
    CASE
    WHEN t5.label = 'Inactive'    THEN
    t1.x_max
    WHEN t5.label = 'Very Potent' THEN
    t1.x_min
    ELSE
    t1.param4
    END              AS ic50,
    CASE
    WHEN substr(
        t1.reported_result, 1, 1
    ) IN ( '>', '<' ) THEN
    to_char(
        substr(
            t1.reported_result, 2, 10
        ), 'FM999999999990.999EEEE'
    )
    ELSE
    to_char(
        t1.reported_result, 'FM999999999990.999EEEE'
    )
    END              AS ic50_rr,
    CASE
    WHEN substr(
        t1.reported_result, 1, 1
    ) IN ( '>', '<' ) THEN
    to_char(
        TO_NUMBER(substr(
            t1.reported_result, 2, 10
        )) * 1000, 'FM999999999990.9999EEEE'
    )
    ELSE
    to_char(
        TO_NUMBER(t1.reported_result) * 1000, 'FM999999999990.9999EEEE'
    )
    END              AS ic50_rr_nm
FROM
    ds3_userdata.su_analysis_results     t1
    LEFT JOIN ds3_userdata.su_groupings            t2 ON t1.group_id = t2.id
    LEFT JOIN ds3_userdata.su_samples              t3 ON t2.sample_id = t3.id
    LEFT JOIN ds3_userdata.tm_experiments          t4 ON t2.experiment_id = t4.experiment_id
    LEFT JOIN ds3_userdata.su_plates               t10 ON t10.experiment_id = t2.experiment_id
                                            AND t2.plate_set = t10.plate_set
    LEFT JOIN (
        SELECT
            b.experiment_id,
            b.plate_number,
            a.plate_id,
            c.well_analysis_id,
            round(
                z_prime, 4
            ) AS z_prime,
            low_avg,
            high_avg
        FROM
            ds3_userdata.su_plate_results a
            LEFT JOIN ds3_userdata.su_plates        b ON a.plate_id = b.id
            LEFT JOIN ds3_userdata.su_well_layers   c ON b.experiment_id = c.experiment_id
                                                       AND a.layer_id = c.id
        WHERE
            c.well_analysis_id = 1
        ORDER BY
            b.experiment_id,
            b.plate_number
    )                                    t11 ON t10.id = t11.plate_id
    LEFT JOIN ds3_userdata.su_classification_rules t5 ON t1.rule_id = t5.id
    LEFT JOIN ds3_userdata.su_analysis_layers      t6 ON t1.layer_id = t6.id
    LEFT JOIN ds3_userdata.su_charts               t7 ON t7.result_id = t1.id
    LEFT JOIN ds3_userdata.su_derived_results      t8 ON t8.result_id = t1.id
    LEFT JOIN ds3_userdata.su_derived_analyses     t9 ON t9.id = t8.derived_analysis_id
WHERE
    t1.status = 1
    AND t4.completed_date IS NOT NULL
    AND t4.protocol_id IN ( 441 )
and t4.experiment_id in (267252, 267250, 267251)
ORDER BY
    t3.display_name
;

-- single exp id:
SELECT  
    a.protocol_id, 
    a.experiment_id,
    a.descr,
    a.protocol,
    b.id,
    c.project_name_ro,
    c.target,
    c.target_conc,
    c.cofactor,
    c.cofactor_conc
FROM studies_summary a
INNER JOIN ic50_results_summary b ON a.experiment_id = b.experiment_id
INNER JOIN ic50_exp_info c ON b.experiment_id = c.experiment_id
  INNER JOIN c$pinpoint.reg_batches d ON b.id = d.formatted_batch_id
  LEFt JOIN (
            SELECT 
                id,
                experiment_id, 
                response_at_hc 
            FROM 
                ic50_new_results_summary
        ) e ON a.experiment_id = e.experiment_id AND d.formatted_batch_id = e.id
WHERE a.experiment_id = 267250
;

select *  
FROM
ds3_userdata.kat6a_trfret_registry_summary
where 
experiment_id = 267250
;

select * from summ_kat6a
where IC50_NM_KAT6A is not null
;


select * from ic50_results_summary
where experiment_id = 267252
;

```
