[Home](../../main.md) | [Prev: Day 209](notes_2025-08-12.md) | [Next: Day 211](./notes_2025-08-14.md)

## üìù Day 210, Wednesday - `notes_2025-08-13.md`
 

### US348
- Create a tool to transform user Mass-Spec data to a standardized analysis format
    * able to load new `.txt` which was the second version from client; changing the format and analysis yet after already submitting the first file
    * before loading into pandas ran several neovim commands to clean up the file: `:%s/^\v(\S+)-(\d+)-/\1_\2/gc` in order to change hyphens to underscores
    * during analysis noticed that blanks showed `NaN`, this is due to missing `blank_2` row for `K79p`

```bash
grep -i "blank_" 250808_T47D_12well.txt | grep -i "K79p"
blank_1         Unknown         0       061125_Development_Setup_all_Timed_Col2.dam     8/8/2025 9:13:34 PM     Sample Manager w/ SO    1       96      ANSI-96well2mL  6       080825\T47D.wiff      1.00    0.00                    K79p    ng/mL   5.35e+002       N/A     1.05e+002       N/A     N/A     9.60    9.60    30.0    9.58    11      9.50    20      9.63    Base To Base N/A      0.128   N/A     696.500/288.200 Da      N/A     N/A     N/A             N/A     0.0866  6.27e+002       Specify Parameters - MQIII      0.248   0.278   N/A     N/A     N/A     N/A  N/A      N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A             0    0.00     N/A     9.60    N/A     N/A
blank_3         Unknown         0       061125_Development_Setup_all_Timed_Col2.dam     8/9/2025 7:11:14 AM     Sample Manager w/ SO    1       96      ANSI-96well2mL  6       080825\T47D.wiff      1.00    0.00                    K79p    ng/mL   6.85e+003       N/A     1.13e+003       N/A     N/A     9.57    9.60    30.0    9.60    11      9.50    27      9.72    Base To Base N/A      0.222   N/A     696.500/288.200 Da      N/A     N/A     N/A             N/A     0.133   7.94e+001       Specify Parameters - MQIII      2.26    0.528   N/A     N/A     N/A     N/A  N/A      N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A     N/A             0    0.00     N/A     9.57    N/A     N/A
```

* however realised it was due to some missing data after running the search and replace command in neovim, the data went missing, so re-downlaoded raw file and ran the search and replace cleanly again
    * this resolved that issue, but another issue where excel values/data do not correspond to that of the jupyter notebook output
* modularised the code into a `.py` file in parent diretory and imported in the `.ipynb` file, named it `acetylation_analysis_client.ipynb`
* ran `jupyter nbconvert --to script notebooks/acetylation_analysis.ipynb` to convert ipynb file to py file; then formatted to just have on `main()` call
* noticed issue in new excel file, they don't match up and thus when running the script the numbers don't agree as below from `MS Example 250808_T47D_12well.xlsx` in the `Raw` and `4430-1` tabs

#### excel data for 4430-1--1 (4430-1 tab)

|  | 10 |
| --- | --: |
|  | 4430-1--1 |
| K4a | 5.31E+04 |
| K4p | 6.77E+07 |
| K9aK14a | 2.38E+05 |
| K9aK14p | 9.99E+04 |
| K9pK14a | 8.38E+05 |
| K9pK14p | 1.57E+06 |
| K18aK23a | 2.02E+06 |
| K18aK23p | 6.34E+06 |
| K18pK23a | 4.00E+06 |
| K18pK23p | 8.30E+07 |
| K27aK36aK37a | 3.45E+03 |
| K27pK36aK37a | 4.68E+03 |
| K27aK36aK37p | 2.17E+04 |
| K27aK36pK37a | 1.44E+03 |
| K27pK36pK37a | 7.06E+02 |
| K27pK36aK37p | 7.36E+02 |
| K27aK36pK37p | 1.13E+03 |
| K27pK36pK37p | 2.69E+05 |
| K56a | 1.53E+03 |
| K56p | 2.36E+04 |
| K64a | 2.61E+03 |
| K64p | 1.75E+06 |
| K79a | 5.41E+04 |
| K79p | 3.82E+06 |


---

#### excel data for 4430-1--1 (Raw tab)

| Sample Name | Analyte Peak Name | Analyte Peak Area (counts) |
| --- | --- | --: |
| 4430-1--1 | K4a | 3.02E+04 |
| 4430-1--1 | K4p | 5.01E+07 |
| 4430-1--1 | K9aK14a | 3.04E+05 |
| 4430-1--1 | K9aK14p | 7.55E+04 |
| 4430-1--1 | K9pK14a | 5.07E+05 |
| 4430-1--1 | K9pK14p | 1.13E+06 |
| 4430-1--1 | K18aK23a | 2.41E+06 |
| 4430-1--1 | K18aK23p | 4.17E+06 |
| 4430-1--1 | K18pK23a | 2.07E+06 |
| 4430-1--1 | K18pK23p | 5.69E+07 |
| 4430-1--1 | K27aK36aK37a | 2.93E+03 |
| 4430-1--1 | K27pK36aK37a | 7.25E+03 |
| 4430-1--1 | K27aK36aK37p | 1.25E+03 |
| 4430-1--1 | K27aK36pK37a | 2.83E+03 |
| 4430-1--1 | K27pK36pK37a | 1.60E+03 |
| 4430-1--1 | K27pK36aK37p | 9.21E+02 |
| 4430-1--1 | K27aK36pK37p | 1.34E+03 |
| 4430-1--1 | K27pK36pK37p | 1.64E+05 |
| 4430-1--1 | K56a | 5.03E+03 |
| 4430-1--1 | K56p | 1.32E+04 |
| 4430-1--1 | K64a | 2.21E+03 |
| 4430-1--1 | K64p | 1.05E+06 |
| 4430-1--1 | K79a | 3.67E+04 |
| 4430-1--1 | K79p | 1.80E+06 |


---

#### Mass Spectrometry Data Analysis for Acetylation Pattern Quantification

- `mass_spec_module.py` processes mass spectrometry data to analyze acetylation post-translational modifications (PTMs) on peptide residues

1. **File Handling**:
   - Sets up input and output directories
   - Provides an interactive file selection interface (using Jupyter widgets)
   - Reads tab-separated mass spectrometry data files

2. **Data Processing**:
   - Pivots the data to create a matrix of peptide peaks by sample names
   - Groups and sorts samples by their naming patterns
   - Calculates fractional abundances of different acetylation states for specific lysine residues (K4, K9/K14, K18/K23, K27/K36/K37, K56, K64, K79)

3. **Output Generation**:
   - Creates an Excel file with worksheets for each sample group
   - Each worksheet shows the fractional abundances of different acetylation states
   - The output is organized by peptide groups and their acetylation patterns

- The script is designed to help analyze how acetylation patterns change across different samples, which is important for understanding protein regulation and function. The script calculates fractional abundances of acetylation by comparing the peak areas of different acetylation states for specific lysine residues. Here's how it works:

1. **Peptide Identification**:
   - The script identifies different acetylation states of lysine residues (e.g., K4a, K4p, K9aK14a, etc.)
   - 'a' typically represents acetylated, while 'p' represents non-acetylated (or another modification)

2. **Fractional Abundance Calculation**:
   - For each peptide group (e.g., K9K14), the script sums the peak areas of all forms (e.g., K9aK14a, K9aK14p, etc.)
   - It then calculates the fraction of each form by dividing the peak area of each form by the total sum
   - For example, for K9K14:
     - K9aK14a fraction = (K9aK14a peak area) / (K9aK14a + K9aK14p + K9pK14a + K9pK14p peak areas)
     - K9a fraction = (K9aK14a + K9aK14p peak areas) / (total K9K14 peak areas)

3. **Biological Significance**:
   - These fractions represent the relative abundance of each acetylation state
   - They help understand how acetylation patterns change across different samples
   - This is important for studying protein regulation, as acetylation can affect protein function and interactions

The script organizes these fractions into an Excel file, making it easier to compare acetylation patterns across different samples and peptide groups.

---

### Docker Setup

- **Image:** `jupyter/base-notebook`
- **Mounted Volume:** `C:\Users\Disco-lx\Documents` ‚Üí `/home/jovyan/work` inside container
- **Notebook Directory:** `/home/jovyan/work/notebooks`  
  Ensures Jupyter only displays notebooks in the `notebooks` folder.
- **Installed Packages:** `pandas`, `xlsxwriter`, `ipywidgets`  

C:\Users\Disco-lx\Documents
‚îú‚îÄ‚îÄ mass_spec_module.py
‚îî‚îÄ‚îÄ notebooks
    ‚îî‚îÄ‚îÄ acetylation_analysis.ipynb

- Run Command Example (PowerShell)

```powershell
docker run -d -p 8888:8888 `
  -v "C:\Users\Disco-lx\Documents:/home/jovyan/work" `
  jupyter/base-notebook bash -c "pip install pandas xlsxwriter ipywidgets && start-notebook.sh --NotebookApp.notebook_dir=/home/jovyan/work/notebooks --NotebookApp.token=''"
```
