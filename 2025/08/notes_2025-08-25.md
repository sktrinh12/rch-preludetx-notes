[Home](../../main.md) | [Prev: Day 217](notes_2025-08-22.md) | [Next: Day 219](./notes_2025-08-26.md)

## ðŸ“ Day 218, Monday - `notes_2025-08-25.md`


### US341
- develop script to ingest tecan file and upload using mosaic api
    * in the IDS TDP table it also shows the same value for `268823_01` for concentration: 0.0999 uM; which is 1000 magnitude off just as in SU
    * this led to thinking probably mosaic is storing it in the base unit of mM
    * from mosaic docs:

>Mosaic records all measurements in Titian Base Units, which are not the same as the SI Base Unit or the standard SI Derived Unit for the measurement. Titian Base Units were chosen to be more convenient for the common ranges of measurements values used within sample management. The table below specifies the Titian Base Units for the standard unit types. Custom concentration unit types can be configured per installation of Mosaic.

>|Mosaic Unit Type|Dimension|SI Base Unit|Standard SI Derived Unit|Prefixâ€‘less Unit|Titian Base Unit|
>|---|---|---|---|---|---|
>|Mass|Mass|kilograms|kg|g|mg|
>|Volume|Volume|cubic metres|L|L|ÂµL|
>|Molar Concentration|Number/Volume|moles per cubic metre|M|M|mM|
>|Mass Concentration|Mass/Volume|kilograms per cubic metre|kg/L|g/L|mg/mL|

next steps are to: 1) delete SU data to have clean slate, 2) adjust for mM units & update the pipeline python code and then, 3) re-trigger the pipeline for  `268823_01`

Genaro to inform Amy of setting mM base unit for manual Mosaic uploads since she has been experiencing the same issue

- because the original raw input file `.csv` shows in 0.0999 uM, it shows as IDS data:

```json
"reference":"C03"
"fluid_fk":2
"dispensed_location":{...}
"concentration":{
"value":0.0999
"unit":"uM"
}
```

- the `.csv` file shows this row:

```
"",1,"C03",3,3,"C03",3,3,"PRT1007513-001",0.0999,,0.0999,,,,,,,,,100,100,,100,,,,,,,,,,100100.1001001,0.000999
```

- the issue seems like need to calculate final concentration after dilution `C_1 * V_1 = C_2 * V_2`
    * client did not mention anything about this, not well communicated
    * `total_volume_well_value` = 100100.1001001
    * `total_volume_well_unit` = nL
    * `total_volume_dispensed_value` = 100.0
    * `total_volume_dispensed_unit` = nL
    * if calculating with this formula, the resulting concentration for `C03` would be 99.8 pM which is 9.98e-5 or 0.0000998 uM
    * need to calculate using the dilution equation (conservation of moles)
    * **if the user wants dilution equation to be calculated that is an entirely separate step that needs to be included in the logic. Use of `C_1 * V_1 = C_2 * V_2` [references](https://en.wikipedia.org/wiki/Dilution_(equation))

- updated Version 0.2.2 added the dilution formula calculation
    * Added consistent unit conversion for volumes and concentrations
    * Final concentrations now computed after dilution with proper handling of units
    * Added display exponents for concentrations and volumes for easier interpretation
    * Refactored helper functions for clarity and reusability:
        * `convert_volume_to_uL()`
        * `convert_conc_to_mM()`
    * `build_sample_holder()` updated to use these helpers and handle units robustly
    * Fixed potential `KeyError` when volume units use uppercase letters
    * Removed redundant lines in concentration calculation
