[Home](../../main.md) | [Prev: Day 226](notes_2025-09-05.md) | [Next: Day 228](./notes_2025-09-09.md)

## üìù Day 227, Monday - `notes_2025-09-08.md`

### US363
- Modify BioRegister to accommodate dual-payload linkers
    * investigate backend for payload linker and payload relationships if no new logic can be implemented, draft email to DTX support to ask how to implement
        * because n number of PL and P will be inputted by the user
    * investigate `c2c` schema on duplicates:
    * `ADC_REG_INFO` is the main table that shows payload-linker and payload data in the bioregister browser project page
        * it consists of joins with `ADC_CONJUGATE_VW`
    * `ADC_CONJUGATE_VW` has duplicates due to `CHEMICAL_COMPONENT`

```sql
-- ADC_CONJUGATE_VW
with t as (SELECT
    BIOREG_ID,
    ID,
    COMPLEX_NAME,
    COMPLEX_MOLECULAR_WEIGHT,
    FORMATTED_ID,
compound_id,
    REG_NAME,
    MW,
    MOLFILE
FROM (
    SELECT
        T1.BIOREG_ID,
        T1.ID,
        T1.NAME AS COMPLEX_NAME,
        T1.MOLECULAR_WEIGHT AS COMPLEX_MOLECULAR_WEIGHT,
        T3.FORMATTED_ID AS FORMATTED_ID,
        T3.REG_NAME AS REG_NAME,
        T3.MW AS MW,
        T2.compound_id,
        T3.MOLFILE AS MOLFILE,
        ROW_NUMBER() OVER (PARTITION BY T1.BIOREG_ID, T3.FORMATTED_ID ORDER BY T1.ID) as rn
    FROM
        C2C.COMPLEX_ T1
    JOIN
        C2C.CHEMICAL_COMPONENT T2 ON T1.ID = T2.OWNER_ID AND T2.owningclass = 'Complex'
    JOIN
        DS3_USERDATA.CHEM_COMPONENTS_VW T3 ON T2.COMPOUND_ID = T3.formatted_id
)
--WHERE rn = 1
)
select * from t
where bioreg_id = 'PRT5000447'


-- showing duplicates for compound_id but stoichiometry different
select *
    FROM
    C2C.CHEMICAL_COMPONENT
where owner_id = 492


-- the subset (minimal) sql of ADC_REG_INFO that shows the payloads and payload-linkers
SELECT DISTINCT
    b.EXTINCTION_COEFF,
    b.MOLECULAR_WEIGHT,
    b.PI,
    b.NR_ID,
    b.STRING_ID,
    b.SUB_TYPE_ID,
    b.BIOREG_ID,
    b.LAST_UPDATER_ID,
    b.SMILES,
    b.DELETED,
    b.APPROX_MASS,
    b.APPROX_EXT,
    b.INCHI_KEY,
    b.BY_PROTEINS,
    b.ID as b_id,
    b.VERSION as b_version,
    b.CREATOR_ID,
    b.DATE_CREATED,
    b.LAST_UPDATED,
    b.COMPOSITION,
    b.NAME,
    a.formatted_id AS payload_linker,
    f.value AS payload,
    f.id as f_ID,
    f.version,
    f.type_id,
    f.owner_id,
    f.owningclass
  FROM 
      c2c.complex b
  LEFT JOIN 
      c2c.string_value f ON b.id = f.owner_id AND f.type_id = 15
  LEFT JOIN 
      ds3_userdata.adc_conjugate_vw a ON b.bioreg_id = a.bioreg_id
  LEFT JOIN 
      c$pinpoint.reg_data r ON a.formatted_id = r.formatted_id
  WHERE 
      upper(b.composition) NOT LIKE '%DELETED%'
      AND b.bioreg_id = 'PRT5000447'

-- comprehensive version that include payload target
SELECT distinct
    b.bioreg_id,
    g.formatted_id   AS payload_linker,
    f.value          AS payload,
    d.value          AS payload_target
FROM (
        SELECT
            b.id,
            b.bioreg_id,
            a.child_id
        FROM
            c2c.complex_child a
            JOIN c2c.complex b ON b.id = a.complex_id
     ) a
JOIN (
        SELECT
            *
        FROM
            c2c.complex_child a
            JOIN c2c.complex b ON b.id = a.child_id
        WHERE
            upper(composition) NOT LIKE '%DELETED%'
     ) b
  ON b.child_id = a.child_id
LEFT JOIN (
        SELECT
            b.value,
            b.owner_id
        FROM
            c2c.string_value_type a
            JOIN c2c.string_value b ON a.id = b.type_id
        WHERE b.type_id = 15
     ) f
  ON a.child_id = f.owner_id
LEFT JOIN (
        SELECT
            b.value,
            b.owner_id
        FROM
            c2c.string_value_type a
            JOIN c2c.string_value b ON a.id = b.type_id
        WHERE b.type_id = 16
     ) d
  ON a.child_id = d.owner_id
LEFT JOIN (
        SELECT
            a.bioreg_id,
            b.formatted_id
        FROM
            ds3_userdata.adc_conjugate_vw a
            JOIN c$pinpoint.reg_data b ON a.formatted_id = b.formatted_id
     ) g
  ON g.bioreg_id = b.bioreg_id
  where b.bioreg_id = 'PRT5000447'
```

### US348
- Create a tool to transform user Mass-Spec data to a standardized analysis format
    * change `client` ipynb file to include markdown instructions with cell links
    * deleted `error_msg` variable since no longer used
    * use of `create_file_uploader()` to show upload widget

