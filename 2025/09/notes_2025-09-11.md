[Home](../../main.md) | [Prev: Day 229](notes_2025-09-10.md) | [Next: Day 231](./notes_2025-09-12.md)

## 📝 Day 230, Thursday - `notes_2025-09-11.md`

### US363
- Modify BioRegister to accommodate dual-payload linkers
    * use of second column for second payload - need separate `string types` for each payload-target pair
    * `complex.Payload` comes from a multi-select input
    * Internally, it is a `LinkedHashSet`, which may not preserve the UI selection order
    * Indexing directly (`[0]`, `[1]`) can return unexpected results
    * Idea is to reliably map payload codes to target projects for Column 1, Column 2, etc
    * `LinkedHashSet` iteration may reorder elements → don’t trust `[0]/[1]` directly.
    * Normalize payloads to a list of strings
    * keep in mind this is only available to view in ADC Batch List and NOT ADC List; it is `derived`
        * >Tick the box to indicate the value should not be present on the input form. This can be because the value is calculated, or it could be that the value is set by an API call to another system upon registration (such calls can be configured in the configuration file)

```java
// this is just to view the `Set` as a string
def list = (complex.Payload instanceof Collection) 
             ? complex.Payload.collect { it.toString() } 
             : [complex.Payload?.toString()]
```

- Sort ascending to ensure consistent order:

```java
def list = list.sort()
```

- Safe indexing with fallback:

```java
def payload = list.size() > idx ? list[idx] : null
return payload == null ? "No Payload Found" : (payloadMap[payload] ?: "Unknown Target Project")
```

#### `calculation` groovy closure used in BioRegister:

```java
def payloadMap = [
    "PRT1011907": "SMARCA dual",
    "PRT1003404": "SMARCA2",
    "PRT1010300": "CDK9 - Next Gen",
    "PRT1012241": "SMARCA dual",
    "PRT1009753": "SMARCA2",
    "PRT1009761": "SMARCA2",
    "PRT1010344": "SMARCA2",
    "PRT1011307": "CDK9 Degrader",
    "PRT1012073": "RAS Degraders",
    "PRT1012244": "KAT6A - Deg",
    "PRT1003174": "CDK4-6",
    "PRT1009617": "SMARCA payload-linker",
    "PRT1012823": "JAK2-Degrader"
]

def idx = 1 // or 0
def list = (complex.Payload instanceof Collection) 
             ? complex.Payload.collect { it.toString() }.sort() 
             : [complex.Payload?.toString()]

def payload = list.size() > idx ? list[idx] : null
return payload == null ? "No Payload Found" : (payloadMap[payload] ?: "Unknown Target Project")
```

- Fallbacks:
    * No item at index → "No Payload Found"
    * Code not in mapping → "Unknown Target Project"
    * Single-column option: join all mapped projects for display:

```java
return list.collect { payloadMap[it] ?: "Unknown Target Project" }.join(", ")
Sorted list ensures consistent order even if the original set is unordered.
```

- Avoid relying on `LinkedHashSet` internal ordering for multiple columns

#### Example Outputs
- used `bioreg_id`:  `PRT5000445-001`, and `PRT5000446-001` as examples with multi `Payloads`

|Payload Selected | Column 1 | Column 2|
| ----- | ----- | ----- |
|`["PRT1009753", "PRT1011307"]`|SMARCA2|CDK9 Degrader|
|`["PRT1003404", "PRT1009617"]`|SMARCA2|SMARCA payload-linker|
|`["PRT1009753"]`|SMARCA2 |No Payload Found|


### US367
- add additional features for mass-spec jupyter notebook tool
    * updated `mass_spec_module.py` to include conditional formatting 3 colour gradient (green-yellow-red) similar to Excel's Colour Scale
    * investigate how to export as `pzfx` graphpad prism file
        * involves installing `rpy2` library to convert pandas df to R df and then use `RPrism` library to export to `pzfx` file

#### Exporting Pandas DataFrames to GraphPad Prism (.pzfx)

1. **Identified the correct R package**
   - Initially tried `RPrism` (does not exist)
   - Correct package is [`pzfx`](https://CRAN.R-project.org/package=pzfx)

2. **Troubleshooted installation issues**
   - `install.packages("pzfx")` and `devtools::install_github("Yue-Jiang/pzfx")` failed due to R’s `download.file` timeouts
   - Confirmed internet access was fine using `wget`

3. **Manual package installation**
   - Downloaded the tarball manually:
     ```bash
     wget https://cran.r-project.org/src/contrib/pzfx_0.3.0.tar.gz
     ```
   - Installed from source:
     ```bash
     R CMD INSTALL pzfx_0.3.0.tar.gz
     ```

4. **Verified installation**
   ```bash
   Rscript -e 'library(pzfx); packageVersion("pzfx")'
   ```

#### GraphPad Prism notes:

- >Prism Viewer Mode is a free version of Prism that allows you to open and view any file created by GraphPad Prism (Windows or Mac).
    * >Install the latest Prism version: update in the Prism application or download the latest installer from the Updates page
    * >In the activation dialog, select Use Prism in Viewer Mode

- >Prism under WINE [docs](https://www.graphpad.com/support/faq/will-you-port-prism-or-instat-to-linux-does-prism-work-with-the-windows-emulator-wine/)
    * >The idea of WINE is to provide a Windows emulator, so Windows programs will work under Linux.  
    * >One of our users told us in mid-2019 that Prism 8 Windows (64 bit) runs fine under current versions of WINE. Other than some cosmetic issues with icons, he said everything worked fine. Below are his instructions for getting it working. We post this to help others, but GraphPad has not tried to use Wine and cannot provide technical support:
    * >### Installation Instructions
    >1. Create a 64-bit wine prefix (32-bit did not work for me).
    >export WINEARCH=win64
    >export WINEPREFIX=~/.prism8
    >wineboot -i
    >2. Install DLLs and fonts. gdiplus is required to launch the application (it crashes otherwise). msxml6 is required to read and save .pzfx files (because they contain XML headers). .pzf files work just fine without msxml6. Finally, Windows fonts are required to render text in graphs properly. If corefonts doesn't work, try allfonts or copying fonts from a Windows installation. The Arch Linux wiki has a couple of good guides for this.
    >winetricks gdiplus msxml6 corefonts
    >3. Finally, run the 64-bit msi Prism installer.
    >wine start ~/Downloads/InstallPrism8-64bit.msi
    >Prism under Windows under Linux
    >If you run Windows as a virtual machine (using Vmware software) under Linux, then any Windows software will run under Windows. 
