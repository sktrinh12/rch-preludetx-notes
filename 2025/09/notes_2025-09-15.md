[Home](../../main.md) | [Prev: Day 231](notes_2025-09-12.md) | [Next: Day 233](./notes_2025-09-16.md)

## 📝 Day 232, Monday - `notes_2025-09-15.md`

### US369
- validate ms tool using the excel file as ref 
    * This behavior comes from **floating-point precision** and **rounding symmetry**:
    * Computers represent decimals in binary floating-point, which cannot always store the exact decimal value
    * Two values that look the same (e.g. `0.000` vs `0.000132`) may differ slightly at a precision of `5e-4` or smaller
    * When subtracting, those differences show up as small residuals, both positive and negative, depending on whether one number was rounded up or down
    * `out_data` is copy from excel file
    * `frac_df` is computed from code

#### `2141_2_3`: `K4a`

* From `frac_df`: `0.000132`
* From `out_data`: `0.000000`
* Subtraction:

  $$
  0.000132 - 0.000000 = 0.000132
  $$

---

### `2141_2_3`: `K4p`

* From `frac_df`: `0.999868`
* From `backup_data`: `1.000000`
* Subtraction:

  $$
  0.999868 - 1.000000 = -0.000132
  $$

This explains why there is both `+0.000132` and `-0.000132`. It’s the same rounding effect, but in different directions

---

### `2141_2_3`: `K9aK14a`

* From `frac_df`: `0.001402`
* From `backup_data`: `0.001000`
* Subtraction:

  $$
  0.001402 - 0.001000 = 0.000402
  $$

---


#### Similarity Check with `np.allclose()`

>- Returns True if two arrays are element-wise equal within a tolerance. The tolerance values are positive, typically very small numbers. The relative difference (rtol * abs(b)) and the absolute difference atol are added together to compare against the absolute difference between a and b. [numpy docs](https://numpy.org/devdocs/reference/generated/numpy.allclose.html)

* For each pair of elements `a` and `b`, `np.allclose()` checks:

$$
|a - b| \leq \text{atol} + \text{rtol} \cdot |b|
$$

* **`atol` (absolute tolerance):**
    * Maximum allowed difference when values are near zero
    * `0.000132` is smaller than `5e-4` → considered close if `atol=5e-4` (since any absolute difference smaller than or equal to `atol` is considered 'close')

```python
np.allclose(frac_subset_np, backup_subset_np, atol=5e-4)
```

- all dataframes return True except `4430_1` due to `NaN` which can't be evaluated; but observing the difference values, which are order of -7 or -8 in magnitude, one can recognise that the differences are extremely small and thus considered 'equal'

#### aws ec2 updated command:
- show the public ip and public dns name; this is only food-for-thought since no longer pursing the purpose of exporting directly as `pzfx` file since it is only open-source and client uses the `.prism` file
    * the new `ec2 run-instance` command will use the 2025 version of windows ami instead of the original 2022

```bash
aws ec2 run-instances --image-id "ami-0e3c2921641a4a215" --instance-type "t3.micro" --key-name "strinh" --block-device-mappings '{"DeviceName":"/dev/sda1","Ebs":{"Encrypted":true,"DeleteOnTermination":true,"KmsKeyId":"arn:aws:kms:us-east-1:581351078906:key/2ec60e5b-730e-4f97-8f73-a35dda160929","SnapshotId":"snap-043e541b3f6be8b9d","VolumeSize":30,"VolumeType":"gp2"}}' --network-interfaces '{"SubnetId":"subnet-06b662fd5609083cb","AssociatePublicIpAddress":true,"DeviceIndex":0,"Groups":["sg-09f682ebd7007a345"]}' --credit-specification '{"CpuCredits":"unlimited"}' --tag-specifications '{"ResourceType":"instance","Tags":[{"Key":"Name","Value":"preludetx-prism-windows"}]}' --private-dns-name-options '{"HostnameType":"ip-name","EnableResourceNameDnsARecord":false,"EnableResourceNameDnsAAAARecord":false}' --count "1" --profile rchsandbox

aws ec2 describe-instances \
    --query "Reservations[*].Instances[*].[InstanceId,State.Name,PublicIpAddress,PublicDnsName,Tags[?Key=='Name'].Value|[0]]" \
    --output table \
    --profile rchsandbox
```

### US367
- add additional features for mass-spec jupyter notebook tool
    * since there was significant hurdles to create a `.pzfx` output (the client would have to work with the `pzfx` format and not the `prism` format), no longer is requesting, only the excel sheet with the same format; during real-time sharing, we couldn't find the export to `.pzfx` function. perhaps the XML version? nevertheless this route is not longer  being followed
    * during meeting confirmed with Genaro that the current export of each compound matrix would need to be conditionally formatted (green-to-red); and an additional sheet that has the prism format to be copied by the user
    * updated `acetylation_analysis.ipynb` for testing of new functions; once got the code working, updated `mass_spec_module.py`; removed `pandastor` code and the second button
        * updated conditional formatting to apply row-wise and not data-block-wise
