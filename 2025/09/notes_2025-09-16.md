[Home](../../main.md) | [Prev: Day 232](notes_2025-09-15.md) | [Next: Day 234](./notes_2025-09-17.md)

## 📝 Day 233, Tuesday - `notes_2025-09-16.md`

### US358
- Mosaic to Dotmatics pipeline does not populate correct inventory values
    * after TS shared github code; able to see that since v1.2.0 (Feb 13 2025) this bug fix has already been addressed, however the new version was never pushed to TDP pipeline; it is currently using a non-existent 1.1.1 version (according to ChangeLog)
    * the new code exists in `ts_client_preludetx_task_script_hts_plate_reader_ids_to_dotmatics/combine.py`


```python
DISPLAY_EXPONENT_TO_CONCENTRATION_UNIT_MOSAIC_MAPPING = {
    3: "kM",
    0: "M",
    -3: "mM",
    -6: "uM",
    -9: "nM",
}

DISPLAY_EXPONENT_TO_VOLUME_UNIT_MOSAIC_MAPPING = {
    3: "kL",
    0: "L",
    -3: "mL",
    -6: "uL",
    -9: "nL",
}

    concentration_exponent = concentration.get("displayExponent", None)
    if concentration_exponent is not None:
        concentration_exponent[
    if (
        concentration_exponent
        in DISPLAY_EXPONENT_TO_CONCENTRATION_UNIT_MOSAIC_MAPPING
    ):
        sample_info[
            "conc_unit"
        ] = DISPLAY_EXPONENT_TO_CONCENTRATION_UNIT_MOSAIC_MAPPING[
            concentration_exponent
        ]
except (TypeError, AttributeError) as exp:
    print(
        exp
    )  # fallbacks in create_well_data for missing / not supported concentration information

try:
    # Get Sample Volume
    volume = solution_sample.get("volume", None)
    volume_value = volume.get("value", None)
    if volume_value is not None:
        sample_info["volume"] = volume_value

except (TypeError, AttributeError) as exp:
    print(exp)  # we have fallbacks in create_well_data for missing entries here
except IndexError as exp:
    # Get Sample Volume Unit
    volume_exponent = volume.get("displayExponent", None)
    if volume_exponent in DISPLAY_EXPONENT_TO_VOLUME_UNIT_MOSAIC_MAPPING:
        sample_info["volume_unit"] = DISPLAY_EXPONENT_TO_VOLUME_UNIT_MOSAIC_MAPPING[
            volume_exponent
        ]

except AttributeError as exp:
```

### US366
- investigate feasability of payload relationship with target using inheritance
    * research as `food-for-thought`: postgres db to store data/info and then have a external connection from DTX using JDBC in the `Connections` tab
    * enabled `check-box` within the `Database` tab of `Settings` (Allow direct (delegated) JDBC connections for querying, browsing, sorting etc.)
        * >Defines dynamic JDBC connection settings. Multiple checkboxes can be ticked: `enabled - enables Dynamic JDBC connections`

```
jdbc:postgresql://database-2.cpemvzgrv5z5.us-east-1.rds.amazonaws.com:5432/postgres?sslmode=require
```


- run docker container client 
    * type `\d` to show database

```
docker run -it --rm \
  postgres:16 \
  psql -h database-2.cpemvzgrv5z5.us-east-1.rds.amazonaws.com \
       -U postgres


\c postgres

GRANT USAGE ON SCHEMA public TO postgres;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO postgres;
```

- ran insert queries to populate data:

```sql
CREATE TABLE PG_ADC_PAYLOAD_JOIN (
    ID BIGINT PRIMARY KEY,
    RANDOM_WORD TEXT
);

INSERT INTO PG_ADC_PAYLOAD_JOIN (ID, RANDOM_WORD) VALUES
(1010300, 'Alpha'),
(1012241, 'Beacon'),
(1009753, 'Cobalt'),
(1011307, 'Delta'),
(1012073, 'Echo'),
(1003174, 'Falcon'),
(1012823, 'Garnet'),
(1010344, 'Harbor'),
(1011907, 'Indigo'),
(1009617, 'Jasper'),
(1003404, 'Kodiak'),
(1012244, 'Lumen');
```

### US371
- investigate when Dani Beam was granted admin rights in Inventory
    * `tmp_dbeam_inv_logs` was created by below:
    * this was saved as a DS and then exported using the View Wizard as a `.csv` it was attached to the user story

```sql
select 
    a.storage_object_type,
    a.action,
    cast(a.action_date as date) as action_date,
    to_char(a.action_date, 'HH24:MI:SS') as action_time,
    a.isid,
    a.status,
    b.description
from tm_storage_audit_new a
join tm_storage_container b
    on a.storage_object_id = b.id
where a.isid like 'dbeam'
order by a.action_date desc, a.action asc
```

- investigated other tables to find any audits or logs that indicate when the user was granted admin rights; but nothing shows any trace

```sql
select * from
gateway.ROLES_NONTP_AUDIT

select distinct audit_type from ds3_appdata.dotmatics_audit
where isid = 'dbeam'

select * from admin_audit 
where isid like 'D%'

select * from tm_storage_audit
where created_by like 'D%'

select isid, objectname, role_id, valuename, group_id 
from GATEWAY.PERSONNEL_ROLES
where isid = 'DBEAM'

select * from tmp_dbeam_inv_logs
```

- sql below shows what projects he has access to:

```sql
select isid, objectname, valuename
from GATEWAY.PERSONNEL_ROLES
where
isid = 'DBEAM'
```

|ISID|OBJECTNAME|VALUENAME|
|----|----------|---------|
|DBEAM|PROJECT|REGISTRY|
|DBEAM|PROJECT|CDK|
|DBEAM|PROJECT|PI3Kα|
|DBEAM|PROJECT|SMARCA2|
|DBEAM|PROJECT|KAT6A|
|DBEAM|PROJECT|ALZHEIMERS_DEMO|
|DBEAM|PROJECT|BIOREGISTER_V2|
|DBEAM|PROJECT|SMARCA2|
|DBEAM|PROJECT|KAT6A|
|DBEAM|PROJECT|BCL2|
|DBEAM|PROJECT|ALZHEIMERS_DEMO|
|DBEAM|PROJECT|BIOLOGYELN|
|DBEAM|PROJECT|CDK|
|DBEAM|PROJECT|CDKS_EMBL|
|DBEAM|PROJECT|CHEMELN|
|DBEAM|PROJECT|CHEMISTRYEXPLORER|
|DBEAM|PROJECT|CODDB|
|DBEAM|PROJECT|ELN_CHEM|
|DBEAM|PROJECT|EXTERNAL_COMPOUNDS|
|DBEAM|PROJECT|FRAGMENT_LIBRARY|
|DBEAM|PROJECT|MARKETED_DRUGS_V01|
|DBEAM|PROJECT|MCL1|
|DBEAM|PROJECT|NSD2|
|DBEAM|PROJECT|PI3Kα|
|DBEAM|PROJECT|POLQ|
|DBEAM|PROJECT|PRMT5_|
|DBEAM|PROJECT|REAGENTS|
|DBEAM|PROJECT|REGISTERED_COMPOUNDS|
|DBEAM|PROJECT|REGISTRY|
|DBEAM|PROJECT|Registry 2.0|
|DBEAM|PROJECT|STUDIESDATA|
|DBEAM|PROJECT|STAG1|
|DBEAM|PROJECT|FRAGMENT_UPLOAD|
|DBEAM|PROJECT|ELN_CHEM_NEW|
|DBEAM|PROJECT|JAK2-Degrader|
|DBEAM|PROJECT|TERNARY_DATA|
|DBEAM|PROJECT|BIOREGISTER|
|DBEAM|PROJECT|Assign Project|
|DBEAM|PROJECT|RAS_DEGRADERS|

- this sql shows the user's role:

```sql
select * from
ds3_appdata.role_master_vw
where isid = 'DBEAM'
```

|ISID|ROLE|COMPONENT|
|----|----|---------|
|DBEAM|ADMIN|STORAGE_MANAGER|
