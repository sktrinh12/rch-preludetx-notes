[Home](../../main.md) | [Prev: Day 233](notes_2025-09-16.md) | [Next: Day 235](./notes_2025-09-18.md)

## üìù Day 234, Wednesday - `notes_2025-09-17.md`

### US371
- investigate when Dani Beam was granted admin rights in Inventory
    * double check sql for `TMP_DBEAM_INV_LOG`
    * discovered it was sorted by `action_date` and `action_type` in descending order; which was not super evident when looking at the file
    * presented to preludetx and happy with results, however expressed that they need to contact the end-user to confirm when admin rights were granted; will explain the responsibility and accountability that is involved with such privileges
    * After investigation, doesn't seem DTX collects logs or changes to user roles
    * only able to supply the log file to show all the action tasks that were requested to the Inventory module; based off of the data it can be assumed the very first task was approximately when admin rights were given; but is not a guarantee


### US366
- investigate feasability of payload relationship with target using inheritance
    * test the external database on DTX again
    * quick aws cli command to spin up the postgres db
    * If tried to assign a single subnet directly, AWS wouldn‚Äôt know where to place the DB if you later wanted Multi-AZ failover, or if it needed to temporarily move the instance
    * Subnet groups standardise where RDS instances can go, so AWS can handle internal routing, failover, maintenance, and scaling consistently
    * Subnet group = template of possible subnets for RDS
    * Publicly accessible = the DB will get a public IP if it lands in a public subnet
    * Multiple AZs are required in the subnet group, but doesn‚Äôt force multi-AZ deployment

- create public subnet group for rds

```bash
aws rds create-db-subnet-group \
  --db-subnet-group-name rds-public-subnet-group \
  --db-subnet-group-description "Subnet group for public RDS access" \
  --subnet-ids subnet-074002489fcb3cf3b subnet-06b662fd5609083cb \
  --profile rchsandbox
```

- actual command to spin up rds db

```bash
aws rds create-db-instance \
  --db-instance-identifier preludetx-dtx \
  --engine postgres \
  --engine-version 17.4 \
  --master-username postgres \
  --master-user-password 'preludetx' \
  --db-instance-class db.t4g.micro \
  --allocated-storage 20 \
  --storage-type gp3 \
  --publicly-accessible \
  --vpc-security-group-ids sg-071b239f5f3486b9a \
  --no-multi-az \
  --db-subnet-group-name rds-public-subnet-group \
  --profile rchsandbox
```

- check the status after deploying the db:

```bash
aws rds describe-db-instances \
  --db-instance-identifier preludetx-dtx \
  --query "DBInstances[0].[DBInstanceIdentifier,DBInstanceStatus,Endpoint.Address,Endpoint.Port]" \
  --output text \
  --profile rchsandbox
```

- delete rds instance

```bash
aws rds delete-db-instance \
  --db-instance-identifier preludetx-dtx \
  --skip-final-snapshot \
  --profile rchsandbox
```

- delete rds subnet group

```bash
aws rds delete-db-subnet-group \
  --db-subnet-group-name rds-public-subnet-group \
  --profile rchsandbox
```

#### 1. Two Distinct Connection Methods in Dotmatics
- **DB Links**: Designed for Oracle-to-Oracle connections. Uses Oracle-specific TNS strings (`(DESCRIPTION=...(SID=orcl))`).
- **JDBC Connections**: Universal method for any database (PostgreSQL, MySQL, etc.). Uses standard JDBC URLs (`jdbc:postgresql://host/db`).

#### 2. Successful PostgreSQL JDBC Connection
- Configured JDBC connector with valid green checks:
  - **Type**: `PostgreSQL`
  - **Mode**: `Custom URL`
  - **URL**: `jdbc:postgresql://host:5432/db?sslmode=require`
- Connection is active and validated by Dotmatics

#### 3. Query Limitations Discovered
- **Direct Joins Are Not Possible**: A single SQL query cannot join tables across Oracle and PostgreSQL directly.
- **Error Evidence**: 
  - `ORA-00903`: Oracle syntax fails on PostgreSQL connection.
  - `PSQLException: relation "oracle_table" does not exist`: PostgreSQL cannot see Oracle tables.

#### 4. The Root Cause: Database Siloing
- JDBC connections create direct "tunnels" to one database.
- SQL queries are executed entirely within the target database's engine.
- Cross-database references are invalid syntax for the receiving engine.

#### 5: Oracle Database Gateway
- **Requires DBA setup** of Oracle Heterogeneous Services.
- Creates a DB Link that allows Oracle to query PostgreSQL via JDBC.
- **Enables true cross-database joins** using Oracle's syntax:
  ```sql
  SELECT o.data, p.data 
  FROM oracle_table o 
  JOIN postgres_table@pglink p ON o.id = p.id;
  ```

#### 6: Pop-up SQL 
- **Pop-up SQL** was successful for the postgres database
  ```sql
  SELECT
  FROM PUBLIC.PG_ADC_PAYLOAD_JOIN
  ```
- However failed when trying to join:
  ```sql
  SELECT a.payload,
  b.random_word
  FROM ds3_userdata.adc_payload_list a
  JOIN public.PG_ADC_PAYLOAD_JOIN b
  ON a.id = b.id
  ```
